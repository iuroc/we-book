# 书香漫卷小程序

## 功能规划

1. 底部导航栏：书架、书城、功能、书圈、我的
2. 功能包含功能列表，包含 2 组工具，分别是导入本地图书，AI 工具箱
   - 导入本地图书，包括从网页读取图书、导入本地图书
   - AI 工具箱包含 编写诗歌、编写歌词、编写文章、图书推荐
3. 书城使用超星 API 加载电子书，不含期刊，顶部包含分类选项卡，下面是图书列表
4. 书圈包含用户发布的帖子，帖子允许上传图片和编辑文本
5. 我的包含我的收藏，

## 功能规划

1. 导航栏：书架、书城、功能、圈子、我的
2. 书架：包含 2 类图书
   - 用户上传图书：保存在服务器，首选 Dodo 三方存储，其次考虑服务器本地存储
   - 书城加入书架：保存数据库记录，指向在线书城图书记录
   - 两类图书不通过选项卡筛选，只是列表项本身标记项目类型
   - 右上角包含“本地导入图书”“抓取文章链接”按钮
3. 书城：包括选项卡，用于筛选不同类型的图书，图书内容直接从超星去获取
4. 功能：进行分组，包括“内容导入”和“AI 工具箱”
   - 内容导入：导入 PDF、导入 EPUB、导入 TXT、导入 Word、导入 HTML、抓取文章链接
   - AI 工具箱：文章生成，文案润色，图书推荐，歌词生成，电影推荐，歌曲推荐，网页设计
5. 我的：包含“我的收藏”、“阅读历史（保留最近 3 个月）”、“评论我的”、“修改昵称”、“注销账号（清除数据库中的用户数据）”、“分享小程序”

## 关于用户系统

1. 用户进入小程序，首选判断缓存的用户信息，包括 openID（数据库存储）、sessionKey（数据库存储）、nickName（服务器存储）、avatarURL（服务器存储），并且使用 wx.checkSession 检查 session 有效性，如果失效了，则通过 wx.login 获得 code，然后将 code 传给开发服务器，服务器获取 openID 和 sessionKey，并且从数据库拉取用户信息，一并返回，如果用户信息在数据库中不存在，则创建默认的用户信息记录。
2. 用户进入小程序，判断缓存中是否存在用户信息
   - 如果不存在，则跳转到获取用户信息页面，要求用户输入昵称和选择头像，然后点击“开始使用”，上传 code、nickname、avatar，服务器根据 code 获得 openID 和 sessionKey，然后根据 openID、nickname、avatar、sessionKey 创建用户信息记录，并返回到小程序端本地存储
   - 如果存在，则验证其中的 sessionKey 是否有效，如果有效，则直接利用当前的用户信息，如果无效，则根据 code 向服务器换取新的 sessionKey，同时服务器数据库也刷新 sessionKey 的存储，换的新的 sessionKey 后，使用新的用户信息进行后续操作。
3. 取消全部的本地存储，改为服务端存储，每次启动小程序，都调用 wx.login 获得 code 并根据 code 请求服务器得到详细的用户信息，其中可能用户信息不存在，则自动跳转到 welcome 完善用户信息。